<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Promptica - لوحة التحكم</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- React + ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"  crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"  crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script> 
  <!-- Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"  rel="stylesheet">
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f9fafb;
      color: #1f2937;
    }
    .table-container {
      overflow-x: auto;
    }
    .level-badge {
      padding: 0.3rem 0.6rem;
      border-radius: 4px;
      font-size: 0.8rem;
      display: inline-block;
      margin-top: 4px;
    }
    .card {
      transition: transform 0.2s ease;
      &:hover {
        transform: scale(1.02);
      }
    }
  </style>
</head>
<body class="min-h-screen bg-gray-50 p-6">
  <!-- Banner -->
  <div class="mb-6">
    <img src="ToolBar1.png" alt="بانير" class="w-full h-auto rounded-lg shadow-md object-cover max-h-64">
  </div>

  <!-- Header -->
  <header class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-indigo-600">لوحة التحكم - Promptica</h1>
    <div class="flex space-x-4">
      <a href="welcome.html" class="text-indigo-600 hover:text-indigo-800 underline">الترحيب</a>
      <button id="langToggle" class="text-indigo-600 hover:text-indigo-800">English</button>
      <button onclick="logout()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded">تسجيل الخروج</button>
    </div>
  </header>

  <!-- Tabs -->
  <div class="mb-6">
    <button 
      class={`px-4 py-2 rounded-full ${activeTab === 'dashboard' ? 'bg-indigo-600 text-white' : 'bg-gray-200 text-gray-700'}`}
      onclick={() => setActiveTab('dashboard')}
    >
      🌐 لوحة المعلومات
    </button>
    <button 
      class={`px-4 py-2 rounded-full ${activeTab === 'prompts' ? 'bg-indigo-600 text-white' : 'bg-gray-200 text-gray-700'}`}
      onclick={() => setActiveTab('prompts')}
    >
      📄 إدارة البرومبتات والتعليقات
    </button>
  </div>

  <!-- Main Content -->
  <div id="root" class="max-w-4xl mx-auto">
    {activeTab === 'prompts' && (
      <App />
    )}
  </div>

  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6"></script> 
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    function App() {
      const translations = {
        ar: {
          dashboard: "لوحة المعلومات",
          managePrompts: "إدارة البرومبتات",
          receivedFeedback: "التعليقات الواردة",
          mainCategory: "القسم الرئيسي",
          subCategory: "القسم الفرعي",
          level: "المستوى",
          addNewPrompt: "إضافة برومبت جديد",
          importDataButton: "📥 استيراد بيانات من Markdown",
          bulkAddPrompts: "إضافة مجموعة برومبتات",
          filterByLevel: "فلترة حسب المستوى",
          moreText: "أكثر",
          lessText: "أقل",
          compliant: "مطابق",
          nonCompliant: "غير مطابق",
          markCompliant: "تصنيف كمطابق",
          markNonCompliant: "تصنيف كغير مطابق",
          deleteComment: "حذف التعليق",
          noCommentsFound: "لا توجد تعليقات بعد.",
          deleteCommentConfirm: "هل أنت متأكد من حذف هذا التعليق؟",
          commentTypes: {
            suggestion: "اقتراح",
            bug: "مشكلة",
            design: "تصميم",
            translation: "ترجمة",
            other: "أخرى"
          }
        },
        en: {
          // ... (الترجمات الإنجليزية)
        }
      };

      const language = localStorage.getItem('language') || 'ar';
      const currentTranslation = translations[language];

      // البيانات الأساسية
      const [prompts, setPrompts] = useState([]);
      const [categories, setCategories] = useState([]);
      const [subCategories, setSubCategories] = useState({});
      const [comments, setComments] = useState([]);
      const [activeTab, setActiveTab] = useState('prompts');
      const [selectedCategoryTab, setSelectedCategoryTab] = useState('all');
      const [selectedLevel, setSelectedLevel] = useState('all');
      const [commentFilter, setCommentFilter] = useState('all');

      // تحميل البيانات من localStorage
      useEffect(() => {
        const loadPrompts = () => {
          const savedPrompts = JSON.parse(localStorage.getItem('prompts')) || [];
          setPrompts(savedPrompts);
        };
        const loadCategories = () => {
          const savedCategories = JSON.parse(localStorage.getItem('categories')) || ['عام'];
          setCategories(savedCategories);
        };
        const loadSubCategories = () => {
          const savedSubCategories = JSON.parse(localStorage.getItem('subCategories')) || {};
          setSubCategories(savedSubCategories);
        };
        const loadComments = () => {
          const savedComments = JSON.parse(localStorage.getItem('comments')) || [];
          setComments(savedComments);
        };
        loadPrompts();
        loadCategories();
        loadSubCategories();
        loadComments();
      }, []);

      // الفلترة المزدوجة للبرومبتات
      const filteredPrompts = prompts.filter(prompt => 
        (selectedCategoryTab === 'all' || 
          prompt.category === selectedCategoryTab || 
          prompt.subCategory === selectedCategoryTab) &&
        (selectedLevel === 'all' || prompt.level === selectedLevel)
      );

      // الفلترة للتعليقات
      const filteredComments = comments.filter(comment => {
        if (commentFilter === 'all') return true;
        return comment.compliant === commentFilter;
      });

      // دالة إضافة برومبت جديد
      const [newMainCategory, setNewMainCategory] = useState('');
      const [newSubCategory, setNewSubCategory] = useState('');
      const [selectedMainCategory, setSelectedMainCategory] = useState('');
      const [promptText, setPromptText] = useState('');
      const [promptLevel, setPromptLevel] = useState('متوسط');
      const [isValidForm, setIsValidForm] = useState(false);

      useEffect(() => {
        const isFormValid = promptText.trim() && 
                           selectedMainCategory && 
                           newSubCategory.trim();
        setIsValidForm(isFormValid);
      }, [promptText, selectedMainCategory, newSubCategory]);

      const handleAddPrompt = () => {
        if (!isValidForm) return;
        const newPrompt = {
          id: Date.now(),
          text: promptText,
          category: selectedMainCategory,
          subCategory: newSubCategory,
          level: promptLevel,
          tokens: calculateTokens(promptText),
          createdAt: new Date().toISOString()
        };
        const updatedPrompts = [...prompts, newPrompt];
        setPrompts(updatedPrompts);
        localStorage.setItem('prompts', JSON.stringify(updatedPrompts));

        // تحديث الأقسام إذا كان جديدًا
        if (!categories.includes(newPrompt.category)) {
          setCategories([...categories, newPrompt.category]);
          localStorage.setItem('categories', JSON.stringify([...categories, newPrompt.category]));
        }

        // إعادة تعيين النموذج
        setPromptText('');
        setSelectedMainCategory('');
        setNewSubCategory('');
        setPromptLevel('متوسط');
      };

      // دالة حذف برومبت
      const confirmDeletePrompt = (id) => {
        if (!window.confirm('هل أنت متأكد من الحذف؟')) return;
        const updatedPrompts = prompts.filter(p => p.id !== id);
        setPrompts(updatedPrompts);
        localStorage.setItem('prompts', JSON.stringify(updatedPrompts));
      };

      // دالة نسخ برومبت
      const copyPromptText = (text) => {
        navigator.clipboard.writeText(text);
        alert('تم النسخ!');
      };

      // دالة إدارة التعليقات
      const toggleCommentStatus = (id, status) => {
        const updatedComments = comments.map(comment => 
          comment.id === id ? { ...comment, compliant: status } : comment
        );
        setComments(updatedComments);
        localStorage.setItem('comments', JSON.stringify(updatedComments));
      };

      const confirmDeleteComment = (id) => {
        if (!window.confirm('هل أنت متأكد من حذف هذا التعليق؟')) return;
        const filteredComments = comments.filter(c => c.id !== id);
        setComments(filteredComments);
        localStorage.setItem('comments', JSON.stringify(filteredComments));
      };

      // دالة حساب التوكنات
      const calculateTokens = (text) => {
        return Math.ceil(text.split(/\s+/).length * 1.25);
      };

      return (
        <div>
          <div className="space-y-6">
            {/* فلترة الأقسام والمستويات */}
            <div className="flex flex-wrap gap-4 mb-6">
              <div>
                <label className="block mb-2">{currentTranslation.mainCategory}</label>
                <select 
                  value={selectedCategoryTab} 
                  onChange={(e) => setSelectedCategoryTab(e.target.value)}
                  className="p-3 border rounded w-full sm:w-64"
                >
                  <option value="all">🌍 الكل</option>
                  {categories.map(cat => (
                    <option key={cat} value={cat}>{cat}</option>
                  ))}
                </select>
              </div>
              <div>
                <label className="block mb-2">{currentTranslation.level}</label>
                <select 
                  value={selectedLevel} 
                  onChange={(e) => setSelectedLevel(e.target.value)}
                  className="p-3 border rounded w-full sm:w-64"
                >
                  <option value="all">🌍 الكل</option>
                  <option value="مبتدئ">🎓 مبتدئ</option>
                  <option value="متوسط">🎯 متوسط</option>
                  <option value="محترف">🏆 محترف</option>
                </select>
              </div>
            </div>

            {/* جدول البرومبتات */}
            <div className="bg-white p-6 rounded shadow-md mb-6">
              <h3 className="font-semibold text-lg mb-4">{currentTranslation.currentPrompts}</h3>
              <table className="min-w-full divide-y divide-gray-200">
                <thead className="bg-gray-50">
                  <tr>
                    <th className="px-4 py-3 text-right text-xs font-medium uppercase tracking-wider">النص</th>
                    <th className="px-4 py-3 text-right text-xs font-medium uppercase tracking-wider">القسم</th>
                    <th className="px-4 py-3 text-right text-xs font-medium uppercase tracking-wider">القسم الفرعي</th>
                    <th className="px-4 py-3 text-right text-xs font-medium uppercase tracking-wider">المستوى</th>
                    <th className="px-4 py-3 text-right text-xs font-medium uppercase tracking-wider">tokens</th>
                    <th className="px-4 py-3 text-right text-xs font-medium uppercase tracking-wider">الإجراءات</th>
                  </tr>
                </thead>
                <tbody className="bg-white divide-y divide-gray-200">
                  {filteredPrompts.map(prompt => (
                    <tr key={prompt.id}>
                      <td className="px-4 py-4 line-clamp-3">{prompt.text}</td>
                      <td className="px-4 py-4">{prompt.category}</td>
                      <td className="px-4 py-4">{prompt.subCategory || '-'}</td>
                      <td className="px-4 py-4">
                        {prompt.level === 'مبتدئ' && <span className="bg-yellow-100 text-yellow-700 px-2 rounded">مبتدئ</span>}
                        {prompt.level === 'متوسط' && <span className="bg-blue-100 text-blue-700 px-2 rounded">متوسط</span>}
                        {prompt.level === 'محترف' && <span className="bg-purple-100 text-purple-700 px-2 rounded">محترف</span>}
                      </td>
                      <td className="px-4 py-4">{prompt.tokens}</td>
                      <td className="px-4 py-4 whitespace-nowrap space-x-3 rtl:space-x-reverse">
                        <button onClick={() => copyPromptText(prompt.text)} className="text-blue-600 hover:text-blue-800 transition duration-300">📋 نسخ</button>
                        <button onClick={() => confirmDeletePrompt(prompt.id)} className="text-red-600 hover:text-red-800 transition duration-300">🗑️ حذف</button>
                      </td>
                    </tr>
                  ))}
                  {prompts.length === 0 && (
                    <tr>
                      <td colSpan="6" className="px-4 py-4 text-center text-gray-500">لا توجد برومبتات مضافة بعد.</td>
                    </tr>
                  )}
                </tbody>
              </table>
            </div>

            {/* قسم التعليقات */}
            <div className="bg-white p-6 rounded shadow-md mb-6">
              <h3 className="font-semibold text-lg mb-4">{currentTranslation.receivedFeedback}</h3>

              {/* فلترة التعليقات */}
              <div className="flex flex-wrap gap-3 mb-4">
                <button 
                  onClick={() => setCommentFilter('all')} 
                  className={`px-4 py-2 rounded ${commentFilter === 'all' ? 'bg-gray-200 text-gray-700' : 'bg-white text-gray-900 shadow'}`}
                >
                  🌍 الكل
                </button>
                <button 
                  onClick={() => setCommentFilter('compliant')} 
                  className={`px-4 py-2 rounded ${commentFilter === 'compliant' ? 'bg-green-200 text-green-700' : 'bg-white text-gray-900 shadow'}`}
                >
                  ✅ مطابق
                </button>
                <button 
                  onClick={() => setCommentFilter('non_compliant')} 
                  className={`px-4 py-2 rounded ${commentFilter === 'non_compliant' ? 'bg-red-200 text-red-700' : 'bg-white text-gray-900 shadow'}`}
                >
                  ❌ غير مطابق
                </button>
              </div>

              {/* جدول التعليقات */}
              <table className="min-w-full divide-y divide-gray-200">
                <thead className="bg-gray-50">
                  <tr>
                    <th className="px-4 py-3 text-right text-xs font-medium uppercase tracking-wider">المستخدم</th>
                    <th className="px-4 py-3 text-right text-xs font-medium uppercase tracking-wider">البريد الإلكتروني</th>
                    <th className="px-4 py-3 text-right text-xs font-medium uppercase tracking-wider">نوع التعليق</th>
                    <th className="px-4 py-3 text-right text-xs font-medium uppercase tracking-wider">الرسالة</th>
                    <th className="px-4 py-3 text-right text-xs font-medium uppercase tracking-wider">الإجراءات</th>
                  </tr>
                </thead>
                <tbody className="bg-white divide-y divide-gray-200">
                  {filteredComments.map(comment => (
                    <tr key={comment.id}>
                      <td className="px-4 py-4">{comment.user || '-'}</td>
                      <td className="px-4 py-4">{comment.email || '-'}</td>
                      <td className="px-4 py-4">{currentTranslation.commentTypes[comment.type]}</td>
                      <td className="px-4 py-4 line-clamp-3">{comment.message}</td>
                      <td className="px-4 py-4 whitespace-nowrap space-x-3 rtl:space-x-reverse">
                        <button 
                          onClick={() => toggleCommentStatus(comment.id, 'compliant')}
                          className={`px-3 py-1 rounded ${comment.compliant === 'compliant' ? 'bg-green-400 text-white' : 'bg-gray-200'}`}
                        >
                          ✅ مطابق
                        </button>
                        <button 
                          onClick={() => toggleCommentStatus(comment.id, 'non_compliant')}
                          className={`px-3 py-1 rounded ${comment.compliant === 'non_compliant' ? 'bg-red-400 text-white' : 'bg-gray-200'}`}
                        >
                          ❌ غير مطابق
                        </button>
                        <button 
                          onClick={() => confirmDeleteComment(comment.id)}
                          className="text-red-500 hover:text-red-700 transition duration-300"
                        >
                          🗑️ حذف
                        </button>
                      </td>
                    </tr>
                  ))}
                  {comments.length === 0 && (
                    <tr>
                      <td colSpan="5" className="px-4 py-4 text-center text-gray-500">لا توجد تعليقات بعد.</td>
                    </tr>
                  )}
                </tbody>
              </table>
            </div>

            {/* نموذج إضافة برومبت */}
            <div className="bg-white p-6 rounded shadow-md mt-6">
              <h3 className="font-semibold text-lg mb-4">{currentTranslation.addNewPrompt}</h3>
              <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <select 
                  value={selectedMainCategory} 
                  onChange={(e) => setSelectedMainCategory(e.target.value)}
                  className="p-3 border rounded col-span-2 sm:col-span-1"
                  required
                >
                  <option value="">اختر القسم الرئيسي...</option>
                  {categories.map(cat => <option key={cat} value={cat}>{cat}</option>)}
                </select>
                <select 
                  value={newSubCategory} 
                  onChange={(e) => setNewSubCategory(e.target.value)}
                  className="p-3 border rounded col-span-2 sm:col-span-1"
                  required
                >
                  <option value="">اختر القسم الفرعي...</option>
                  {subCategories[selectedMainCategory]?.map(sub => <option key={sub} value={sub}>{sub}</option>)}
                </select>
                <div className="sm:col-span-1">
                  <label className="block mb-2">المستوى:</label>
                  <select 
                    value={promptLevel} 
                    onChange={(e) => setPromptLevel(e.target.value)}
                    className="p-3 border rounded"
                  >
                    <option value="مبتدئ">🎓 مبتدئ</option>
                    <option value="متوسط">🎯 متوسط</option>
                    <option value="محترف">🏆 محترف</option>
                  </select>
                </div>
                <textarea 
                  value={promptText} 
                  onChange={(e) => setPromptText(e.target.value)}
                  placeholder="أدخل نص البرومبت..."
                  className="p-3 border rounded col-span-full mt-4"
                />
                <div className="sm:col-span-3 flex justify-end">
                  <button 
                    onClick={handleAddPrompt} 
                    className={`px-4 py-2 rounded ${isValidForm ? 'bg-green-600 hover:bg-green-700 text-white' : 'bg-gray-200 text-gray-500 cursor-not-allowed'}`}
                  >
                    ➕ إضافة برومبت
                  </button>
                </div>
              </div>
            </div>

            {/* زر استيراد البيانات */}
            <div className="mt-6">
              <button 
                onClick={() => window.open('import-data.html', '_blank', 'width=800,height=600')}
                className="px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded transition duration-300"
              >
                📥 {currentTranslation.importDataButton}
              </button>
            </div>

            {/* زر إضافة مجموعة برومبتات */}
            <div className="mt-4">
              <button 
                onClick={() => window.open('add-prompts.html', '_blank', 'width=800,height=600')}
                className="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded transition duration-300"
              >
                📥 {currentTranslation.bulkAddPrompts}
              </button>
            </div>
          </div>
        </div>
      );
    }

    // ربط الترجمة
    ReactDOM.render(
      <App />,
      document.getElementById('root')
    );
  </script>

  <script>
    // دعم الترجمة للـ JavaScript
    const savedLang = localStorage.getItem('language') || 'ar';
    document.documentElement.setAttribute('lang', savedLang);
    document.documentElement.setAttribute('dir', savedLang === 'ar' ? 'rtl' : 'ltr');

    // دالة تغيير اللغة
    function toggleLanguage() {
      const newLang = savedLang === 'ar' ? 'en' : 'ar';
      localStorage.setItem('language', newLang);
      location.reload();
    }

    // دالة تسجيل الخروج
    function logout() {
      localStorage.removeItem('user');
      window.location.href = 'welcome.html';
    }

    // إضافة أزرار العودة للـ JavaScript
    function goBack() {
      window.history.back();
    }

    function goHome() {
      window.location.href = 'index.html';
    }

    // إضافة دعم العرض الديناميكي للتعليقات
    document.getElementById('root').addEventListener('DOMContentLoaded', () => {
      const comments = JSON.parse(localStorage.getItem('comments')) || [];
      setComments(comments);
    });
  </script>

  <footer class="mt-12 text-center text-sm text-gray-500">
    &copy; <span id="year"></span> Promptica. جميع الحقوق محفوظة.
    <script>document.getElementById("year").textContent = new Date().getFullYear();</script>
  </footer>
</body>
</html>
