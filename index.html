<DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>MN.gpt - مدير البرومبتات</title>
  <!-- Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"  rel="stylesheet" />
</head>
<body class="bg-gray-50 text-gray-800">
  <div id="app" class="max-w-6xl mx-auto px-4 py-8"></div>

  <script>
    // 🔒 التحقق من تسجيل الدخول
    const userRole = localStorage.getItem('userRole');

    if (!userRole) {
      window.location.href = 'login.html';
    }

    // 💾 تحميل البيانات من localStorage
    let prompts = JSON.parse(localStorage.getItem('prompts')) || [
      { id: 1, text: 'اشرح مفهوم الذكاء الاصطناعي بطريقة بسيطة.', category: 'تعليمي', tokens: 23 },
      { id: 2, text: 'اكتب قصة قصيرة عن رحلة إلى الفضاء.', category: 'إبداعي', tokens: 45 },
      { id: 3, text: 'ما هو تأثير التكنولوجيا على التعليم؟', category: 'تحليل بيانات', tokens: 18 },
    ];

    let categories = JSON.parse(localStorage.getItem('categories')) || ['عام', 'تعليمي', 'إبداعي', 'تحليل بيانات'];

    // 🖋️ HTML بناء
    const app = document.getElementById('app');

    const dashboardHTML = `
      <header class="flex justify-between items-center pb-4 border-b border-gray-200 mb-6">
        <h1 class="text-2xl font-bold text-indigo-700">MN.gpt</h1>
        ${userRole === 'admin' ? `<a href="#" onclick="switchTab('prompts')" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">إدارة البرومبتات</a>` : ''}
      </header>

      <div class="mb-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">لوحة التحكم</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-lg font-semibold text-gray-700 mb-2">إجمالي البرومبتات</h3>
            <p class="text-3xl font-bold text-indigo-600">${prompts.length}</p>
          </div>
          <div class="bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-lg font-semibold text-gray-700 mb-2">إجمالي التوكيانات</h3>
            <p class="text-3xl font-bold text-blue-600">${prompts.reduce((sum, p) => sum + p.tokens, 0)}</p>
          </div>
          <div class="bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-lg font-semibold text-gray-700 mb-2">عدد الأقسام</h3>
            <p class="text-3xl font-bold text-green-600">${categories.length}</p>
          </div>
        </div>
      </div>

      <footer class="pt-6 border-t border-gray-200 text-center text-sm text-gray-500 mt-10">
        &copy; ${new Date().getFullYear()} MN.gpt. جميع الحقوق محفوظة.
      </footer>
    `;

    const promptsHTML = `
      <header class="flex justify-between items-center pb-4 border-b border-gray-200 mb-6">
        <h1 class="text-2xl font-bold text-indigo-700">MN.gpt</h1>
        <a href="#" onclick="switchTab('dashboard')" class="text-indigo-600 hover:underline">← العودة إلى لوحة التحكم</a>
      </header>

      <h2 class="text-2xl font-bold text-gray-800 mb-6">إدارة البرومبتات</h2>

      <form id="promptForm" class="bg-white shadow rounded-lg p-6 mb-8">
        <input type="text" id="promptText" placeholder="مثال: اشرح مفهوم الذكاء الاصطناعي..." class="w-full p-3 border border-gray-300 rounded mb-4 focus:outline-none focus:ring-2 focus:ring-indigo-500" required />
        
        <select id="promptCategory" class="w-full p-3 border border-gray-300 rounded mb-4 focus:outline-none focus:ring-2 focus:ring-indigo-500">
          ${categories.map(cat => `<option value="${cat}">${cat}</option>`).join('')}
          <option disabled>─────────────</option>
          <option value="">+ إضافة قسم جديد</option>
        </select>

        <input type="number" id="promptTokens" placeholder="عدد التوكيانات" class="w-full p-3 border border-gray-300 rounded mb-4 focus:outline-none focus:ring-2 focus:ring-indigo-500" />

        <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">
          إضافة برومبت
        </button>
      </form>

      <div class="bg-white rounded-lg shadow-md overflow-hidden mb-8">
        <div class="p-4 border-b border-gray-200">
          <h3 class="font-semibold text-lg">قائمة البرومبتات</h3>
        </div>
        <ul class="divide-y divide-gray-200">
          ${prompts.map(prompt => `
            <li class="p-4 flex justify-between items-center hover:bg-gray-50">
              <span>${prompt.text} — <strong>${prompt.category}</strong> (${prompt.tokens} توكيان)</span>
              ${userRole === 'admin' ? `<button onclick="deletePrompt(${prompt.id})" class="text-red-600 hover:text-red-800">حذف</button>` : ''}
            </li>
          `).join('')}
          ${prompts.length === 0 ? '<li class="p-4 text-center text-gray-500">لا توجد برومبتات مضافة بعد</li>' : ''}
        </ul>
      </div>

      ${userRole === 'admin' ? `
      <div class="bg-white rounded-lg shadow-md overflow-hidden">
        <div class="p-4 border-b border-gray-200">
          <h3 class="font-semibold text-lg">الأقسام</h3>
        </div>
        <ul class="divide-y divide-gray-200">
          ${categories.map(cat => `
            <li class="p-4 flex justify-between items-center hover:bg-gray-50">
              <span>${cat}</span>
              <div class="space-x-2 space-x-reverse">
                <button onclick="editCategory('${cat}')" class="text-yellow-600">تعديل</button>
                <button onclick="deleteCategory('${cat}')" class="text-red-600">حذف</button>
              </div>
            </li>
          `).join('')}
        </ul>
      </div>
      ` : ''}

      <footer class="pt-6 border-t border-gray-200 text-center text-sm text-gray-500 mt-10">
        &copy; ${new Date().getFullYear()} MN.gpt. جميع الحقوق محفوظة.
      </footer>
    `;

    function switchTab(tab) {
      if (tab === 'dashboard') {
        document.getElementById('app').innerHTML = dashboardHTML;
      } else {
        document.getElementById('app').innerHTML = promptsHTML;
      }
    }

    function deletePrompt(id) {
      prompts = prompts.filter(p => p.id !== id);
      localStorage.setItem('prompts', JSON.stringify(prompts));
      switchTab('prompts');
    }

    function deleteCategory(category) {
      if (!confirm('هل تريد حذف القسم "' + category + '" وجميع البرومبتات المرتبطة به؟')) return;
      prompts = prompts.filter(p => p.category !== category);
      categories = categories.filter(c => c !== category);
      localStorage.setItem('prompts', JSON.stringify(prompts));
      localStorage.setItem('categories', JSON.stringify(categories));
      switchTab('prompts');
    }

    function editCategory(oldName) {
      const newName = prompt('عدل اسم القسم:', oldName);
      if (!newName || !oldName || !categories.includes(oldName)) return;
      prompts = prompts.map(p => (p.category === oldName ? { ...p, category: newName } : p));
      categories = categories.map(c => (c === oldName ? newName : c));
      localStorage.setItem('prompts', JSON.stringify(prompts));
      localStorage.setItem('categories', JSON.stringify(categories));
      switchTab('prompts');
    }

    document.getElementById('promptForm')?.addEventListener('submit', function(e) {
      e.preventDefault();
      const text = document.getElementById('promptText').value.trim();
      const category = document.getElementById('promptCategory').value.trim();
      const tokens = parseInt(document.getElementById('promptTokens').value) || 0;

      if (!text || !category) {
        alert("يرجى تعبئة جميع الحقول");
        return;
      }

      const newPrompt = { id: Date.now(), text, category, tokens };
      prompts.push(newPrompt);
      if (!categories.includes(category)) {
        categories.push(category);
      }

      localStorage.setItem('prompts', JSON.stringify(prompts));
      localStorage.setItem('categories', JSON.stringify(categories));

      switchTab('prompts');
    });

    // 👉 عرض التبويب الأولي
    const activeTab = location.hash.slice(1) || 'dashboard';
    switchTab(activeTab);
  </script>
</body>
</html>
