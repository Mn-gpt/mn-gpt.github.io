<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - Promptica</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <!-- React + ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"  crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"  crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script> 

  <!-- Tailwind CSS CDN -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"  rel="stylesheet">

  <!-- Internal Styles -->
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f9fafb;
      color:  #1f2937;
      line-height: 1.8;
    }
    .line-clamp-3 {
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    @media (max-width: 640px) {
      html { font-size: 16px; }
      textarea { font-size: 0.875rem; padding: 0.75rem; }
    }
  </style>
</head>
<body class="min-h-screen bg-gray-50 p-4">

  <!-- Header -->
  <header class="flex justify-between items-center pb-4 border-b border-gray-200 mb-6">
    <h1 class="text-2xl sm:text-3xl font-bold text-indigo-700">Promptica</h1>
    <a href="index.html" class="text-indigo-600 hover:text-indigo-800 underline">Ø§Ù„Ø¹ÙˆØ¯Ø©</a>
  </header>

  <!-- Root Div for React App -->
  <div id="root"></div>

  <!-- Footer -->
  <footer class="mt-8 pt-4 border-t border-gray-200 text-center text-sm text-gray-500">
    &copy; {new Date().getFullYear()} Promptica. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.
  </footer>

  <!-- React Code -->
  <script type="text/babel">
    const { useState } = window.React;

    function ImportDataPage() {
      const [inputText, setInputText] = useState('');
      const [parsedPrompts, setParsedPrompts] = useState([]);
      const [categories, setCategories] = useState(['Ø¹Ø§Ù…']);
      const [subCategories, setSubCategories] = useState({});
      const [selectedMainCategory, setSelectedMainCategory] = useState('');
      const [selectedSubCategory, setSelectedSubCategory] = useState('');
      const [showResults, setShowResults] = useState(false);

      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† localStorage
      React.useEffect(() => {
        const savedCategories = JSON.parse(localStorage.getItem('categories'));
        const savedSubCategories = JSON.parse(localStorage.getItem('subCategories'));

        if (savedCategories) setCategories(savedCategories);
        if (savedSubCategories) setSubCategories(savedSubCategories);
      }, []);

      // Ø¯Ø§Ù„Ø© ØªØ­Ù„ÙŠÙ„ Markdown
      const parseMarkdown = (text) => {
        const lines = text.split('\n');
        const result = [];
        let currentMainCategory = '';
        let currentSubCategory = '';
        let promptBuffer = '';

        lines.forEach(line => {
          line = line.trim();
          if (line.startsWith('# ') && !line.startsWith('##')) {
            currentMainCategory = line.replace('# ', '').trim();
          } else if (line.startsWith('## ')) {
            currentSubCategory = line.replace('## ', '').trim();
          } else if (line.startsWith('>')) {
            promptBuffer = line.replace(/^>\s*/, '').trim();
            if (currentMainCategory && currentSubCategory && promptBuffer) {
              result.push({
                id: Date.now() + Math.random(),
                text: promptBuffer,
                category: currentMainCategory,
                subCategory: currentSubCategory,
                tokens: promptBuffer.split(/\s+/).length
              });
              promptBuffer = '';
            }
          }
        });

        return result;
      };

      // Ø¹Ù†Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù†Øµ
      const handleInputChange = (e) => {
        const value = e.target.value;
        setInputText(value);
        const prompts = parseMarkdown(value);
        setParsedPrompts(prompts);
        setShowResults(!!value);
      };

      // Ø±ÙØ¹ Ù…Ù„Ù Markdown
      const handleFileUpload = (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (event) => {
          const content = event.target.result;
          setInputText(content);
          const prompts = parseMarkdown(content);
          setParsedPrompts(prompts);
          setShowResults(true);
        };
        reader.readAsText(file);
      };

      // Ø­ÙØ¸ Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨ØªØ§Øª
      const savePrompts = () => {
        if (!selectedMainCategory || parsedPrompts.length === 0) {
          alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ.");
          return;
        }

        const filteredPrompts = parsedPrompts.map(p => ({
          ...p,
          category: selectedMainCategory,
          subCategory: selectedSubCategory || p.subCategory || 'ØºÙŠØ± Ù…ØµÙ†Ù'
        }));

        const existingPrompts = JSON.parse(localStorage.getItem('prompts')) || [];
        const updatedPrompts = [...existingPrompts, ...filteredPrompts];
        localStorage.setItem('prompts', JSON.stringify(updatedPrompts));
        setParsedPrompts([]);
        setInputText('');
        alert(`âœ… ØªÙ… Ø­ÙØ¸ ${filteredPrompts.length} Ø¨Ø±ÙˆÙ…Ø¨Øª.`);
      };

      return (
        <div className="container mx-auto max-w-4xl">
          <h2 className="text-2xl sm:text-3xl font-bold text-gray-800 mb-6">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>

          {/* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */}
          <div className="bg-white p-6 rounded shadow-md mb-6">
            <label className="block text-lg font-medium mb-2">Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø±Ø§Ø¯ Ø§Ø³ØªÙŠØ±Ø§Ø¯Ù‡:</label>
            <textarea
              rows="12"
              placeholder="Ù„ØµÙ‚ Ù†Øµ Ø¨ØµÙŠØºØ© Markdown ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ù‚Ø³Ø§Ù… ÙˆØ¨Ø±ÙˆÙ…Ø¨ØªØ§Øª..."
              value={inputText}
              onChange={handleInputChange}
              className="w-full p-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500"
            ></textarea>
          </div>

          {/* Ø±ÙØ¹ Ù…Ù„Ù Markdown */}
          <div className="mt-6">
            <label className="block text-lg font-medium mb-2">Ø£Ùˆ Ø§Ø±ÙØ¹ Ù…Ù„Ù Markdown:</label>
            <input
              type="file"
              accept=".md"
              onChange={handleFileUpload}
              className="w-full p-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500"
            />
          </div>

          {/* Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© */}
          {showResults && parsedPrompts.length > 0 && (
            <div className="bg-white p-6 rounded shadow-md mt-6">
              <h3 className="font-semibold text-lg mb-4">Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨ØªØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©:</h3>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                {parsedPrompts.slice(0, 5).map((prompt, idx) => (
                  <div key={idx} className="border border-gray-200 p-3 rounded hover:bg-gray-50">
                    <p className="text-sm text-gray-600">{prompt.text}</p>
                  </div>
                ))}
              </div>
              {parsedPrompts.length > 5 && (
                <p className="text-sm text-gray-500 mt-2">+ {parsedPrompts.length - 5} Ø¨Ø±ÙˆÙ…Ø¨Øª Ø¢Ø®Ø±...</p>
              )}
            </div>
          )}

          {/* Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø³Ù… Ù„Ù„Ø­ÙØ¸ */}
          {showResults && parsedPrompts.length > 0 && (
            <div className="bg-white p-6 rounded shadow-md mt-6">
              <h3 className="font-semibold text-lg mb-4">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨ØªØ§Øª:</h3>
              <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <select
                  value={selectedMainCategory}
                  onChange={(e) => setSelectedMainCategory(e.target.value)}
                  className="p-3 border border-gray-300 rounded"
                >
                  <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</option>
                  {categories.map(cat => (
                    <option key={cat} value={cat}>{cat}</option>
                  ))}
                </select>
                <select
                  value={selectedSubCategory}
                  onChange={(e) => setSelectedSubCategory(e.target.value)}
                  className="p-3 border border-gray-300 rounded"
                >
                  <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ</option>
                  {subCategories[selectedMainCategory]?.map(sub => (
                    <option key={sub} value={sub}>{sub}</option>
                  ))}
                </select>
              </div>
              <button
                onClick={savePrompts}
                disabled={!selectedMainCategory}
                className={`mt-4 px-6 py-3 rounded transition-colors ${
                  selectedMainCategory
                    ? 'bg-green-600 hover:bg-green-700 text-white'
                    : 'bg-gray-200 cursor-not-allowed text-gray-500'
                }`}
              >
                ğŸš€ Ø§Ø³ØªÙŠØ±Ø§Ø¯ {parsedPrompts.length} Ø¨Ø±ÙˆÙ…Ø¨Øª
              </button>
            </div>
          )}

          {/* ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ */}
          <div className="bg-blue-50 p-4 rounded shadow-md mt-6">
            <h3 className="font-semibold text-lg mb-2">ÙƒÙŠÙÙŠØ© Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ØŸ</h3>
            <pre className="bg-gray-100 p-3 rounded text-sm overflow-x-auto">
{`
# Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
## Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ
> Ù‡Ø°Ø§ Ù‡Ùˆ Ù†Øµ Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª Ø§Ù„Ø£ÙˆÙ„
> Ù‡Ø°Ø§ Ù‡Ùˆ Ù†Øµ Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª Ø§Ù„Ø«Ø§Ù†ÙŠ

# Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ 2
## Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ 2
> Ù†Øµ Ø¨Ø±ÙˆÙ…Ø¨Øª Ø¬Ø¯ÙŠØ¯ Ù‡Ù†Ø§
`.trim()}
            </pre>
          </div>
        </div>
      );
    }

    const root = window.ReactDOM.createRoot(document.getElementById('root'));
    root.render(<ImportDataPage />);
  </script>
</body>
</html>
