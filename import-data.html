<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>استيراد البيانات</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"  rel="stylesheet" />
</head>
<body class="min-h-screen bg-gray-50 p-4">
  <header class="flex justify-between items-center pb-4 border-b border-gray-200 mb-6">
    <h1 class="text-2xl font-bold text-indigo-700">Promptica - استيراد البيانات</h1>
    <a href="index.html" class="text-indigo-600 hover:text-indigo-800 underline">← العودة</a>
  </header>

  <div class="container mx-auto max-w-4xl">
    <h2 class="text-xl font-semibold text-gray-800 mb-4">رفع ملف Markdown لاستيراد البيانات</h2>
    <p class="text-sm text-gray-600 mb-4">
      يجب أن يكون الملف بصيغة Markdown مثل:
    </p>
    <pre class="bg-gray-100 p-4 rounded mb-6">
{`# قسم رئيسي: المساعد الشخصي

## قسم فرعي: كتابة النصوص
- **برومبت:** كيف أكتب رسالة تقديم لنفسي؟
- **الوصف:** هذا البرومبت يساعد في كتابة رسالة تعريفية.
- **الكلمات:** 200`}
    </pre>

    <input
      type="file"
      accept=".md"
      onChange={(e) => importMarkdown(e)}
      class="mb-6"
    />

    <div id="results" class="space-y-4"></div>
  </div>

  <footer class="mt-8 pt-4 border-t border-gray-200 text-center text-sm text-gray-500">
    &copy; {{new Date().getFullYear()}} Promptica
  </footer>

  <script>
    function importMarkdown(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = async function (e) {
        const text = e.target.result;
        const lines = text.split(/\r?\n/).filter(Boolean);
        let currentCategory = '';
        let currentSubCategory = '';
        const prompts = [];

        lines.forEach(line => {
          line = line.trim();
          if (line.startsWith('# قسم رئيسي:')) {
            currentCategory = line.replace('# قسم رئيسي:', '').trim();
          } else if (line.startsWith('## قسم فرعي:')) {
            currentSubCategory = line.replace('## قسم فرعي:', '').trim();
          } else if (line.startsWith('- **برومبت:**')) {
            const promptText = line.replace('- **برومпт:**', '').trim();
            const descriptionLine = lines[lines.indexOf(line) + 1]?.replace('- **الوصف:**', '').trim() || '';
            const tokensLine = lines[lines.indexOf(line) + 2]?.replace('- **الكلمات:**', '').trim() || '0';

            if (currentCategory && currentSubCategory && promptText) {
              prompts.push({
                id: Date.now() + Math.random(),
                text: promptText,
                category: currentCategory,
                subCategory: currentSubCategory,
                description: descriptionLine,
                tokens: parseInt(tokensLine) || 0
              });
            }
          }
        });

        // حفظ البيانات
        const existingPrompts = JSON.parse(localStorage.getItem('prompts')) || [];
        localStorage.setItem('prompts', JSON.stringify([...existingPrompts, ...prompts]));

        const existingCategories = JSON.parse(localStorage.getItem('categories')) || [];
        if (!existingCategories.includes(currentCategory)) {
          localStorage.setItem('categories', JSON.stringify([...existingCategories, currentCategory]));
        }

        const existingSubCategories = JSON.parse(localStorage.getItem('subCategories')) || {};
        if (!existingSubCategories[currentCategory]) {
          existingSubCategories[currentCategory] = [];
        }
        if (!existingSubCategories[currentCategory].includes(currentSubCategory)) {
          existingSubCategories[currentCategory].push(currentSubCategory);
        }
        localStorage.setItem('subCategories', JSON.stringify(existingSubCategories));

        displayResults(prompts);
      };
      reader.readAsText(file);
    }

    function displayResults(prompts) {
      const container = document.getElementById('results');
      container.innerHTML = '';

      if (prompts.length === 0) {
        container.innerHTML = '<p class="text-red-600">لم يتم العثور على بيانات صالحة.</p>';
        return;
      }

      container.innerHTML = `<p class="text-green-600 mb-4">✅ تم استيراد ${prompts.length} برومبت بنجاح!</p>`;
      const ul = document.createElement('ul');
      ul.className = 'space-y-2';
      prompts.forEach(prompt => {
        const li = document.createElement('li');
        li.className = 'bg-white p-3 rounded shadow-sm text-sm';
        li.textContent = `${prompt.text} (${prompt.category} → ${prompt.subCategory})`;
        ul.appendChild(li);
      });
      container.appendChild(ul);
    }
  </script>
</body>
</html>
